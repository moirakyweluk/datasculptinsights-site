<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Third Space Research</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Evidence-backed research and strategy for complex products and teams." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Blue palette */
      --blue-900:#0a2540;
      --blue-700:#1d4ed8;
      --blue-600:#2563eb;
      --blue-500:#3b82f6;
      --blue-100:#e6f0ff;

      /* keep original var names for minimal changes */
      --green-900:var(--blue-900);
      --green-700:var(--blue-700);
      --green-600:var(--blue-600);
      --green-500:var(--blue-500);
      --green-100:var(--blue-100);

      --ink:#0e0f10;
      --muted:#5b646b;
      --bg:#ffffff;
      --ring:rgba(59,130,246,.35);
      --radius:16px;
      --max:1200px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink); background:var(--bg); line-height:1.6;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }

    /* Header / Nav */
    .site-header{position:sticky; top:0; z-index:50; background:linear-gradient(180deg,var(--green-900),var(--green-700)); color:#fff; border-bottom:1px solid rgba(255,255,255,.08)}
    .nav{max-width:var(--max); margin:0 auto; padding:18px 20px; display:flex; align-items:center; gap:16px}
    .brand{display:flex; align-items:center; gap:12px; text-decoration:none; color:#fff; font-weight:700; letter-spacing:.2px}
    .brand .logo{height:28px; width:auto; display:block; filter:drop-shadow(0 1px 2px rgba(0,0,0,.25))}
    .nav-links{margin-left:auto; display:flex; gap:6px; flex-wrap:wrap}
    .nav-links button{appearance:none; border:0; background:transparent; color:#e8f0ff; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer}
    .nav-links button[aria-current="page"]{background:rgba(255,255,255,.14); box-shadow:0 0 0 1px rgba(255,255,255,.12) inset}
    .nav-links button:focus-visible{outline:3px solid var(--ring); outline-offset:2px}

    /* Views and layout */
    .view{display:none}
    .view.active{display:block}
    .container{max-width:var(--max); margin:0 auto; padding:56px 20px}
    .hero{display:grid; gap:28px; align-items:center}
    @media (min-width:900px){.hero{grid-template-columns:1.2fr .8fr}}
    h1{font-size:clamp(32px,5vw,56px); line-height:1.05; margin:10px 0 14px}
    h2{font-size:clamp(22px,3.4vw,32px); line-height:1.2; margin:0 0 16px}
    h3{font-size:clamp(16px,2.2vw,20px); margin:10px 0}
    p.lede{font-size:clamp(16px,2.1vw,19px); color:var(--muted); margin:0 0 18px}
    .muted{color:var(--muted)}

    .card{border:1px solid #e9eef0; border-radius:var(--radius); background:#fff; padding:18px; box-shadow:0 1px 1px rgba(10,20,30,.02), 0 4px 18px rgba(10,20,30,.04)}

    .logo-strip{margin-top:26px; padding:14px 0; border-top:1px solid #e9eef0; border-bottom:1px solid #e9eef0}
    .logo-row{display:flex; gap:24px; align-items:center; justify-content:space-between; flex-wrap:wrap; opacity:.9}
    .logo-row svg{height:26px; width:auto; display:block; filter:grayscale(100%) contrast(1.2) opacity(.85)}

    /* CTA strip */
    .cta{background:linear-gradient(180deg,var(--green-700),var(--green-900)); color:#eef3ff; margin-top:40px}
    .cta .wrap{max-width:var(--max); margin:0 auto; padding:28px 20px; display:grid; gap:16px}
    @media (min-width:800px){.cta .wrap{grid-template-columns:1fr auto; align-items:center}}
    .cta a.btn{display:inline-flex; align-items:center; gap:10px; text-decoration:none; background:#fff; color:var(--green-700); font-weight:700; padding:12px 16px; border-radius:12px; border:1px solid rgba(0,0,0,.06)}
    .cta a.btn:focus-visible{outline:3px solid #fff; outline-offset:2px}

    /* WHAT WE DO: filters & tiles */
    .grid{display:grid; gap:18px}
    .grid.auto{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    @media (min-width:720px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}}

    .filters{display:flex;flex-wrap:wrap;gap:10px;margin:8px 0 18px}
    .filter{
      appearance:none;border:1px solid #dfe7f6;background:#f5f8ff;color:#0f1715;
      padding:8px 12px;border-radius:12px;font-weight:700;cursor:pointer;font-size:14px;
    }
    .filter[aria-pressed="true"]{background:var(--green-600);color:#fff;border-color:var(--green-600)}

    .service{transition:transform .18s ease, box-shadow .18s ease}
    .service:hover{transform:translateY(-2px);box-shadow:0 6px 22px rgba(10,20,30,.08)}
    .service h3{margin:6px 0 6px}
    .service p{margin:0 0 8px}
    .service ul{margin:0 0 2px 18px}

    .details{margin-top:8px;color:var(--muted)}
    .details[hidden]{display:none}
    .reveal{
      border:0;background:transparent;padding:0;margin-top:6px;
      display:inline-flex;gap:8px;align-items:center;
      color:var(--green-700);font-weight:700;cursor:pointer;
    }
    .reveal svg{width:16px;height:16px}

    /* CASE STUDIES: vertical tabs */
    .cases-wrap{display:grid; gap:18px}
    @media (min-width:900px){.cases-wrap{grid-template-columns:360px 1fr}}

    .case-tablist{display:flex; flex-direction:column; gap:14px}
    .case-tab{
      appearance:none; border:1px solid #e9eef0; background:#fff; cursor:pointer;
      border-radius:16px; padding:20px 22px; text-align:left;
      box-shadow:0 1px 1px rgba(10,20,30,.02), 0 4px 18px rgba(10,20,30,.04);
    }
    .case-tab .kicker{display:inline-flex; align-items:center; gap:8px; background:var(--green-100); color:var(--green-700); padding:7px 12px; border-radius:999px; font-weight:700; font-size:13px}
    .case-tab .title{margin:10px 0 2px; font-weight:800; font-size:clamp(20px,3.1vw,26px); line-height:1.2}
    .case-tab .snippet{margin:0; color:var(--muted); font-size:15px}
    .case-tab[aria-selected="true"]{outline:3px solid var(--ring); box-shadow:0 0 0 1px rgba(59,130,246,.18) inset, 0 8px 24px rgba(10,20,30,.08)}
    .case-tab:focus-visible{outline:3px solid var(--ring); outline-offset:2px}

    .case-panel{display:none}
    .case-panel.active{display:block}
    .case-metrics{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .case-metrics .pill{background:var(--green-100); color:var(--green-700); padding:8px 12px; border-radius:999px; font-weight:700; font-size:13px}

    /* Accessibility helper */
    .sr-only{
      position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    /* Bigger fonts for top nav */
    .nav-links button{
      font-size:16px;
      padding:12px 18px;
      border-radius:12px;
    }
    @media (min-width:900px){
      .nav-links button{ font-size:17px; }
    }
  </style>
</head>
<body>

  <!-- Header / Nav -->
  <header class="site-header" role="banner">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="#home" data-link="home" onclick="navigate('home')">
        <img class="logo" alt="Third Space Research"
             src="https://images.squarespace-cdn.com/content/v1/63dbd7caaf346a420a8eac68/4bdc26df-da80-4edb-85ad-6ce302b79866/ThirdSpaceResearch-Logo-White.png?format=1500w">
        <span class="sr-only">Third Space Research</span>
      </a>
      <div class="nav-links" role="tablist" aria-label="Sections">
        <button role="tab" aria-controls="home"      aria-selected="true"  aria-current="page" data-link="home" onclick="navigate('home')">Home</button>
        <button role="tab" aria-controls="services"  aria-selected="false" data-link="services" onclick="navigate('services')">What We Do</button>
        <button role="tab" aria-controls="cases"     aria-selected="false" data-link="cases" onclick="navigate('cases')">Case Studies</button>
        <button role="tab" aria-controls="why"       aria-selected="false" data-link="why" onclick="navigate('why')">Why Us</button>
        <button role="tab" aria-controls="contact"   aria-selected="false" data-link="contact" onclick="navigate('contact')">Let’s Talk</button>
      </div>
    </nav>
  </header>

  <!-- Home -->
  <main id="home" class="view active" role="tabpanel" aria-labelledby="tab-home">
    <div class="container">
      <!-- Removed the small light-blue pill on purpose -->
      <div class="hero">
        <div>
          <h1>Expert research & strategy for complex products</h1>
          <p class="lede">We help teams make <b>evidence-based decisions</b>, validate opportunities, and ship with confidence—combining <b>academic rigor</b> with <b>practical execution</b>.</p>
        </div>
        <div class="card" aria-hidden="true" style="display:none"></div>
      </div>

      <div class="logo-strip" aria-label="Selected clients">
        <div class="logo-row" aria-hidden="false">
          <svg role="img" aria-label="Novella" viewBox="0 0 300 40"><text x="0" y="28" font-size="26" font-family="Inter" font-weight="700">Novella</text></svg>
          <svg role="img" aria-label="Synapse" viewBox="0 0 260 40"><text x="0" y="28" font-size="26" font-family="Inter" font-weight="700">Synapse</text></svg>
          <svg role="img" aria-label="AstraLabs" viewBox="0 0 200 40"><text x="0" y="28" font-size="26" font-family="Inter" font-weight="700">AstraLabs</text></svg>
        </div>
      </div>
    </div>

    <section class="cta" aria-label="Contact strip">
      <div class="wrap">
        <h3 style="margin:0">Ready to move from insights to impact?</h3>
        <div><a class="btn" href="#contact" onclick="navigate('contact')">Let’s Talk</a></div>
      </div>
    </section>
  </main>

  <!-- WHAT WE DO -->
  <section id="services" class="view" role="tabpanel" aria-labelledby="tab-services">
    <div class="container">
      <h2>What We Do</h2>

      <div class="filters" role="toolbar" aria-label="Filter services">
        <button class="filter" aria-pressed="true"  data-filter="all"     onclick="filterServices('all')">All</button>
        <button class="filter" aria-pressed="false" data-filter="discover" onclick="filterServices('discover')">Discovery & Insights</button>
        <button class="filter" aria-pressed="false" data-filter="testing"  onclick="filterServices('testing')">Concept & Testing</button>
        <button class="filter" aria-pressed="false" data-filter="evidence" onclick="filterServices('evidence')">Evidence & Strategy</button>
        <button class="filter" aria-pressed="false" data-filter="launch"   onclick="filterServices('launch')">Enablement & Launch</button>
      </div>

      <div class="grid auto" style="margin-top:10px">
        <article class="card service" data-service="discover">
          <h3>Discovery &amp; Insights</h3>
          <p class="muted">Understand needs, barriers, and adoption drivers across users, buyers, and stakeholders.</p>
          <ul class="muted">
            <li>Qual &amp; quant studies</li>
            <li>Landscape &amp; competitive scans</li>
            <li>Journey &amp; opportunity maps</li>
          </ul>
          <button class="reveal" type="button" aria-expanded="false" onclick="toggleDetails(this)">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            More details
          </button>
          <div class="details" hidden>
            Mixed-methods plans sized to your stage: quick pulses, deep dives, or hybrid designs to de-risk next bets.
          </div>
        </article>

        <article class="card service" data-service="testing">
          <h3>Concept &amp; Prototype Testing</h3>
          <p class="muted">De-risk value props, UX, and messaging before you scale.</p>
          <ul class="muted">
            <li>Concept &amp; message testing</li>
            <li>Prototype &amp; usability</li>
            <li>Positioning &amp; claims clarity</li>
          </ul>
          <button class="reveal" type="button" aria-expanded="false" onclick="toggleDetails(this)">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            More details
          </button>
          <div class="details" hidden>
            Test with target users, buyers, and internal stakeholders; quantify lift and surface friction to guide the next iteration.
          </div>
        </article>

        <article class="card service" data-service="evidence">
          <h3>Evidence &amp; Strategy</h3>
          <p class="muted">Turn findings into clear choices and defensible plans.</p>
          <ul class="muted">
            <li>Evidence / claims strategy</li>
            <li>Methodologically rigorous studies</li>
            <li>Stakeholder alignment</li>
          </ul>
          <button class="reveal" type="button" aria-expanded="false" onclick="toggleDetails(this)">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            More details
          </button>
          <div class="details" hidden>
            From endpoints and study design to claims matrices and buy-in decks—built to stand up to scrutiny.
          </div>
        </article>

        <article class="card service" data-service="launch">
          <h3>Enablement &amp; Launch</h3>
          <p class="muted">Make insights land in the real world—measure, learn, iterate.</p>
          <ul class="muted">
            <li>User &amp; customer education</li>
            <li>Risk &amp; compliance support</li>
            <li>Go-to-market guidance</li>
          </ul>
          <button class="reveal" type="button" aria-expanded="false" onclick="toggleDetails(this)">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            More details
          </button>
          <div class="details" hidden>
            Enablement built for busy teams: concise assets, measurement loops, and activation plans.
          </div>
        </article>
      </div>
    </div>

    <section class="cta" aria-label="Contact strip">
      <div class="wrap">
        <h3 style="margin:0">Let’s turn evidence into action.</h3>
        <div><a class="btn" href="#contact" onclick="navigate('contact')">Let’s Talk</a></div>
      </div>
    </section>
  </section>

  <!-- CASE STUDIES (vertical tabs) -->
  <section id="cases" class="view" role="tabpanel" aria-labelledby="tab-cases">
    <div class="container">
      <h2>Case Studies</h2>
      <p class="muted" style="margin-top:-6px">A few examples of how we translate research into decisions and outcomes.</p>

      <div class="cases-wrap">
        <!-- LEFT: vertical tablist -->
        <div role="tablist" aria-orientation="vertical" class="case-tablist" id="case-tablist">
          <button role="tab" id="tab-case-1" class="case-tab" aria-selected="true" aria-controls="panel-case-1" data-case="case-1">
            <span class="kicker">B2B SaaS • Pricing & Positioning</span>
            <div class="title">De-risking value proposition for a new analytics product</div>
            <p class="snippet">Expert interviews, market scans, and message testing to clarify adoption drivers.</p>
          </button>

          <button role="tab" id="tab-case-2" class="case-tab" aria-selected="false" aria-controls="panel-case-2" data-case="case-2">
            <span class="kicker">Consumer App • Onboarding</span>
            <div class="title">Onboarding that boosts 90-day retention</div>
            <p class="snippet">Journey mapping and prototype tests to reduce cognitive load and set expectations.</p>
          </button>

          <button role="tab" id="tab-case-3" class="case-tab" aria-selected="false" aria-controls="panel-case-3" data-case="case-3">
            <span class="kicker">Hardware • Operations</span>
            <div class="title">Positioning a device within crowded workflows</div>
            <p class="snippet">Contextual inquiry and claims clarity to shape GTM and training assets.</p>
          </button>
        </div>

        <!-- RIGHT: tabpanels -->
        <div>
          <article id="panel-case-1" role="tabpanel" class="case-panel active" aria-labelledby="tab-case-1" tabindex="-1">
            <div class="card">
              <h3 style="margin-top:0">De-risking a value proposition for a new analytics product</h3>
              <p class="muted">B2B SaaS • Pricing & Positioning</p>
              <p>A product team needed clarity on adoption drivers for a first-to-market analytics tool. We combined expert interviews, market scans, and iterative message testing.</p>
              <ul class="muted" style="margin:0 0 0 18px">
                <li><b>Challenge:</b> Unclear decision pathways across roles</li>
                <li><b>Approach:</b> Mixed-methods research + competitive scan</li>
                <li><b>Output:</b> Evidence-ready positioning & claims map</li>
              </ul>
              <div class="case-metrics">
                <span class="pill">3× faster alignment</span><span class="pill">+28% intent to adopt</span>
              </div>
            </div>
          </article>

          <article id="panel-case-2" role="tabpanel" class="case-panel" aria-labelledby="tab-case-2" tabindex="-1">
            <div class="card">
              <h3 style="margin-top:0">Onboarding that boosts 90-day retention</h3>
              <p class="muted">Consumer App • Onboarding</p>
              <p>A subscription app saw early churn. We mapped journeys and tested onboarding concepts to reduce cognitive load and align expectations.</p>
              <ul class="muted" style="margin:0 0 0 18px">
                <li><b>Challenge:</b> Low activation after day 7</li>
                <li><b>Approach:</b> Journey mapping + prototype testing</li>
                <li><b>Output:</b> Onboarding scripts & micro-content</li>
              </ul>
              <div class="case-metrics">
                <span class="pill">+35% day-30 activation</span><span class="pill">+18 pts NPS</span>
              </div>
            </div>
          </article>

          <article id="panel-case-3" role="tabpanel" class="case-panel" aria-labelledby="tab-case-3" tabindex="-1">
            <div class="card">
              <h3 style="margin-top:0">Positioning a device within crowded workflows</h3>
              <p class="muted">Hardware • Operations</p>
              <p>We clarified use cases and operational barriers across end-users and ops leads to shape GTM and training assets.</p>
              <ul class="muted" style="margin:0 0 0 18px">
                <li><b>Challenge:</b> Competing priorities on the floor</li>
                <li><b>Approach:</b> Contextual inquiry + claims clarity</li>
                <li><b>Output:</b> Role-specific training + adoption playbook</li>
              </ul>
              <div class="case-metrics">
                <span class="pill">−22% setup time</span><span class="pill">+40% trial-to-adopt</span>
              </div>
            </div>
          </article>
        </div>
      </div>
    </div>

    <section class="cta" aria-label="Contact strip">
      <div class="wrap">
        <h3 style="margin:0">Want a deeper dive on a specific problem?</h3>
        <div><a class="btn" href="#contact" onclick="navigate('contact')">Let’s Talk</a></div>
      </div>
    </section>
  </section>

  <!-- WHY US -->
  <section id="why" class="view" role="tabpanel" aria-labelledby="tab-why">
    <div class="container">
      <h2>Why Third Space Research?</h2>
      <div class="hero" style="margin-top:10px">
        <div>
          <ul class="muted" style="margin:0 0 0 18px;">
            <li><strong>Dual-fluency:</strong> academic-grade methods + practical industry execution.</li>
            <li><strong>Domain depth without silos:</strong> we translate across product, design, data, and GTM.</li>
            <li><strong>Right-sized:</strong> pragmatic scoping that moves quickly without sacrificing rigor.</li>
            <li><strong>Action-ready outputs:</strong> clear decisions, not just decks.</li>
          </ul>
        </div>
        <div>
          <img src="https://via.placeholder.com/800x520.png?text=Workshop+%2F+Synthesis" alt="Workshop synthesizing insights" style="width:100%; border-radius:12px; display:block;">
        </div>
      </div>

      <div class="logo-strip" style="border:0; padding-top:0">
        <div class="logo-row" style="justify-content:flex-start; gap:18px">
          <div class="card" style="text-align:center"><h3 style="margin:0">3×</h3><p class="muted" style="margin:6px 0 0">Faster validation cycles</p></div>
          <div class="card" style="text-align:center"><h3 style="margin:0">90%</h3><p class="muted" style="margin:6px 0 0">Stakeholder alignment</p></div>
          <div class="card" style="text-align:center"><h3 style="margin:0">100%</h3><p class="muted" style="margin:6px 0 0">Decision-ready outputs</p></div>
        </div>
      </div>
    </div>

    <section class="cta" aria-label="Contact strip">
      <div class="wrap">
        <h3 style="margin:0">Have a project in mind?</h3>
        <div><a class="btn" href="#contact" onclick="navigate('contact')">Let’s Talk</a></div>
      </div>
    </section>
  </section>

  <!-- Contact -->
  <section id="contact" class="view" role="tabpanel" aria-labelledby="tab-contact">
    <div class="container">
      <h2>Let’s Talk</h2>
      <p class="muted">Tell us a bit about your product or challenge, and we’ll follow up with next steps.</p>

      <div class="card">
        <form action="https://formspree.io/f/your-endpoint" method="POST">
          <label class="sr-only" for="name">Name</label>
          <input id="name" name="name" type="text" placeholder="Your name" required
                 style="width:100%;padding:12px 14px;margin:6px 0;border:1px solid #dbe5f8;border-radius:12px">

          <label class="sr-only" for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="Your email" required
                 style="width:100%;padding:12px 14px;margin:6px 0;border:1px solid #dbe5f8;border-radius:12px">

          <label class="sr-only" for="message">Message</label>
          <textarea id="message" name="message" rows="5" placeholder="How can we help?"
                    style="width:100%;padding:12px 14px;margin:6px 0;border:1px solid #dbe5f8;border-radius:12px"></textarea>

          <button type="submit"
                  style="margin-top:6px; background:var(--green-600); color:#fff; font-weight:700; border:0; padding:12px 16px; border-radius:12px; cursor:pointer">
            Send
          </button>
        </form>
      </div>
    </div>

    <section class="cta" aria-label="Contact strip">
      <div class="wrap">
        <h3 style="margin:0">Prefer email? hello@thirdspaceresearch.com</h3>
        <div><a class="btn" href="mailto:hello@thirdspaceresearch.com">Email Us</a></div>
      </div>
    </section>
  </section>

  <footer class="sr-only" aria-hidden="true">© Third Space Research</footer>

  <script>
    // ---- Top-level SPA nav ----
    const views = Array.from(document.querySelectorAll('.view'));
    const tabs  = Array.from(document.querySelectorAll('.nav-links button'));

    function setActive(sectionId){
      views.forEach(v => v.classList.toggle('active', v.id === sectionId));
      tabs.forEach(t => {
        const on = t.dataset.link === sectionId;
        t.setAttribute('aria-current', on ? 'page' : 'false');
        t.setAttribute('aria-selected', on ? 'true' : 'false');
      });
    }

    function navigate(sectionId){
      history.pushState(null, '', '#' + sectionId);
      setActive(sectionId);
      if(sectionId === 'cases'){
        const deep = (location.hash.split('/')[1]) || 'case-1';
        selectCase(deep);
      }
      const el = document.getElementById(sectionId);
      if (el) el.setAttribute('tabindex', '-1'), el.focus({preventScroll:true});
    }

    (function init(){
      const raw = (location.hash || '#home').slice(1);
      const [section, deep] = raw.split('/');
      setActive(section);
      if(section === 'cases'){ selectCase(deep || 'case-1', {skipHash:true}); }
    })();

    window.addEventListener('hashchange', () => {
      const raw = (location.hash || '#home').slice(1);
      const [section, deep] = raw.split('/');
      setActive(section);
      if(section === 'cases'){ selectCase(deep || 'case-1', {skipHash:true}); }
    });

    // ---- What We Do helpers ----
    function filterServices(key){
      const tiles = document.querySelectorAll('.service');
      const buttons = document.querySelectorAll('.filters .filter');
      buttons.forEach(b => b.setAttribute('aria-pressed', b.dataset.filter === key ? 'true' : 'false'));
      tiles.forEach(t => {
        const show = (key === 'all') || (t.dataset.service === key);
        t.style.display = show ? '' : 'none';
      });
    }

    function toggleDetails(btn){
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
      const details = btn.nextElementSibling;
      if (!details) return;
      if (details.hasAttribute('hidden')) {
        details.removeAttribute('hidden');
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 15l6-6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> Hide details';
      } else {
        details.setAttribute('hidden','');
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> More details';
      }
    }

    // ---- Case Studies: vertical tabs logic ----
    const tablist = document.getElementById('case-tablist');
    const caseTabs = tablist ? Array.from(tablist.querySelectorAll('[role="tab"]')) : [];
    const panels = {
      'case-1': document.getElementById('panel-case-1'),
      'case-2': document.getElementById('panel-case-2'),
      'case-3': document.getElementById('panel-case-3'),
    };

    function selectCase(key, opts={}){
      if(!panels[key]) key = 'case-1';
      caseTabs.forEach(btn => {
        const on = btn.dataset.case === key;
        btn.setAttribute('aria-selected', on ? 'true' : 'false');
        btn.setAttribute('tabindex', on ? '0' : '-1');
      });
      Object.entries(panels).forEach(([k,el]) => el.classList.toggle('active', k === key));

      if(!opts.skipHash){
        const base = '#cases/' + key;
        if(location.hash !== base) history.pushState(null,'',base);
      }
      panels[key].focus({preventScroll:true});
    }

    caseTabs.forEach(btn => btn.addEventListener('click', () => selectCase(btn.dataset.case)));

    tablist && tablist.addEventListener('keydown', (e) => {
      const i = caseTabs.findIndex(b => b === document.activeElement);
      if(i < 0) return;
      let next = i;
      if(e.key === 'ArrowDown') next = (i + 1) % caseTabs.length;
      else if(e.key === 'ArrowUp') next = (i - 1 + caseTabs.length) % caseTabs.length;
      else if(e.key === 'Home') next = 0;
      else if(e.key === 'End') next = caseTabs.length - 1;
      else return;
      caseTabs[next].focus();
      e.preventDefault();
    });
  </script>
</body>
</html>
